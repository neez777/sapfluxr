---
title: "Quickstart Guide"
author: "sapfluxr package"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Quickstart Guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

# Overview

The **sapfluxr** package processes heat pulse velocity data from ICT SFM1x sensors through a complete workflow from raw temperature measurements to daily tree water use estimates.

This quickstart shows the essential workflow. **For detailed explanations**, see the step-by-step vignettes listed below.

## The 7-Step Workflow

```
1. Import Data          → read_heat_pulse_data()
2. Configure            → load_wood_properties(), load_probe_config()
3. Calculate Velocity   → calc_heat_pulse_velocity()
4. Apply Corrections    → spacing, wound, calibration
5. Convert to Flux      → apply_flux_conversion()
6. Integrate Sapwood    → calc_sap_flux()
7. Analyze & Export     → aggregate_daily(), plots
```

## Quick Example

### Installation

```{r install}
# Install from GitHub
# devtools::install_github("username/sapfluxr")
library(sapfluxr)
```

### Complete Pipeline (Minimal Code)

```{r pipeline}
# 1. IMPORT
hp_data <- read_heat_pulse_data("tree_data.txt", trim_incomplete_days = TRUE)

# 2. CONFIGURE
wood <- calculate_wood_properties(load_wood_properties("eucalyptus"))
probe <- load_probe_config("symmetrical")

# 3. CALCULATE VELOCITY
vh <- calc_heat_pulse_velocity(hp_data, methods = c("HRM", "MHR"), wood_properties = wood)

# 4. CORRECTIONS
# Spacing correction
cpt <- detect_changepoints(calculate_daily_minima(vh, "inner", "HRM"))
corrected <- apply_spacing_correction_both_sensors(vh, cpt$changepoints, "HRM")

# Method calibration
cals <- calibrate_multiple_methods(corrected$vh_corrected, "HRM", c("MHR"))
vh_cal <- transform_multiple_methods(corrected$vh_corrected, cals)

# Wound correction (if probe was reinstalled)
wound_history <- data.frame(
  datetime = as.POSIXct("2024-01-15 10:00:00", tz = "UTC"),
  wound_diameter_cm = 0.6
)
vh_final <- apply_wound_correction(vh_cal, wound_history)

# 5. FLUX CONVERSION
flux <- apply_flux_conversion(vh_final, wood, velocity_col = "Vc_cm_hr")

# 6. SAPWOOD INTEGRATION
areas <- calc_sapwood_areas(dbh = 30, sapwood_depth = 2.5)
sap_flux <- calc_sap_flux(flux, areas)

# 7. METRICS & AGGREGATION
metrics <- apply_sapwood_metrics(sap_flux, areas$total_sapwood_area_cm2)
daily <- aggregate_daily(metrics)

# EXPORT
write.csv(metrics, "hourly_flux.csv", row.names = FALSE)
write.csv(daily, "daily_flux.csv", row.names = FALSE)
```

See step-by-step vignettes below for detailed explanations of each function.

## Next Steps: Detailed Vignettes

### Core Workflow

1. **`vignette("step01-data-import")`** - Data import and validation
2. **`vignette("step02-configuration")`** - Wood properties and probe setup  
3. **`vignette("step03-velocity-calculation")`** - Heat pulse velocity methods
4. **`vignette("step04-corrections")`** - Spacing, wound, and calibration
5. **`vignette("step05-flux-conversion")`** - Velocity to flux density
6. **`vignette("step06-sapwood-integration")`** - Tree-level sap flux
7. **`vignette("step07-analysis")`** - Metrics, aggregation, visualization

### Specialized Topics

- **`vignette("wood-properties-workflows")`** - Wood property workflows
- **`vignette("weather-data-vpd")`** - Weather data and VPD
- **`vignette("spacing-correction-calibration")`** - Spacing correction details
- **`vignette("burgess-mathematical-derivation")`** - Mathematical foundations

---

**Start here:** `vignette("step01-data-import")`
