% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/04a_method_calibration.R
\name{calibrate_method_to_primary}
\alias{calibrate_method_to_primary}
\title{Calibrate Secondary Method to Primary Method}
\usage{
calibrate_method_to_primary(
  vh_corrected,
  primary_method = "HRM",
  secondary_method,
  sensor_position = "outer",
  threshold_velocity,
  fit_type = "auto",
  min_points = 50,
  verbose = TRUE
)
}
\arguments{
\item{vh_corrected}{Corrected velocity data (after spacing correction).}

\item{primary_method}{Primary method name (default: "HRM").}

\item{secondary_method}{Secondary method name (e.g., "MHR").}

\item{sensor_position}{Sensor position ("outer" or "inner").}

\item{threshold_velocity}{Minimum velocity for calibration (cm/hr).
Only points where primary method > threshold are used.}

\item{fit_type}{Type of fit: "linear", "quadratic", or "auto" (default: "auto").}

\item{min_points}{Minimum points required for calibration (default: 50).}

\item{verbose}{Logical indicating whether to print summary (default: TRUE).}
}
\value{
A list (class "method_calibration") containing:
\item{coefficients}{Fit coefficients (intercept, slope, quadratic term if applicable)}
\item{fit_type}{Type of fit used ("linear" or "quadratic")}
\item{r_squared}{R-squared of fit}
\item{rmse}{Root mean squared error}
\item{n_points}{Number of points used for calibration}
\item{threshold}{Velocity threshold used}
\item{transformation_function}{Function to transform secondary method values}
\item{primary_method}{Primary method name}
\item{secondary_method}{Secondary method name}
\item{sensor_position}{Sensor position}
\item{calibration_data}{Data frame of calibration points (for plotting)}
}
\description{
Fits relationship between primary and secondary methods in their overlap
region, creating a transformation function to align the secondary method
to the primary method scale.
}
\details{
\strong{Calibration Process:}
\enumerate{
\item Merges primary and secondary method data by pulse_id
\item Filters to points where primary method <= threshold_velocity (valid region)
\item Fits regression: primary ~ secondary (or primary ~ secondary + secondary²)
\item Creates transformation function to convert secondary values to primary scale
\item This transformation is then applied to ALL secondary data, especially above
the threshold where the primary method becomes unreliable
}

\strong{Fit Type Selection:}

If \code{fit_type = "auto"}:
\itemize{
\item Tries both linear and quadratic fits
\item Uses quadratic if R² improves by more than 0.02
\item Otherwise uses simpler linear fit
}

\strong{Transformation:}

The returned transformation function can be used to transform the entire
secondary method dataset to the primary scale using
\code{\link{transform_secondary_method}}.
}
\examples{
\dontrun{
# Calibrate MHR to HRM at 10 cm/hr threshold
calibration <- calibrate_method_to_primary(
  vh_corrected = vh_corrected,
  primary_method = "HRM",
  secondary_method = "MHR",
  sensor_position = "outer",
  threshold_velocity = 10
)

print(calibration$r_squared)
print(calibration$coefficients)
}

}
\seealso{
Other method calibration functions: 
\code{\link{calibrate_multiple_methods}()},
\code{\link{find_optimal_calibration_threshold}()},
\code{\link{transform_multiple_methods}()},
\code{\link{transform_secondary_method}()}
}
\concept{method calibration functions}
