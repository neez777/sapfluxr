% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03a_spacing_correction.R
\name{calculate_zero_offset}
\alias{calculate_zero_offset}
\title{Calculate Zero Offset During Known Zero-Flow Periods}
\usage{
calculate_zero_offset(
  vh_data,
  zero_periods,
  sensor_position,
  method_col = "method",
  method = "HRM",
  vh_col = "Vh_cm_hr"
)
}
\arguments{
\item{vh_data}{Data frame containing validated/filtered velocity data.
Must have columns: datetime, sensor_position, and a velocity column.}

\item{zero_periods}{List of zero-flow periods. Each element should be a list
with \code{start} and \code{end} (datetime strings or POSIXct).
Example: \code{list(list(start = "2024-05-01 00:00:00", end = "2024-05-05 23:59:59"))}}

\item{sensor_position}{Sensor position to analyse ("outer" or "inner")}

\item{method_col}{Name of method column (default: "method")}

\item{method}{Value of method to analyse (default: "HRM")}

\item{vh_col}{Name of velocity column (default: "Vh_cm_hr")}
}
\value{
A list containing:
\item{zero_vh}{Zero offset value rounded to nearest 0.1 cm/hr}
\item{mean_vh_raw}{Raw mean without rounding}
\item{n_observations}{Total number of observations in zero-flow periods}
\item{overall_sd}{Standard deviation across all zero-flow observations}
\item{overall_cv}{Coefficient of variation (CV = SD/mean)}
\item{period_summary}{Data frame summarising each zero-flow period}
\item{sensor}{Sensor position analysed}
\item{method}{Method analysed}
}
\description{
Determines mean Vh when true sap flow = 0, indicating probe misalignment.
The zero offset is used to determine spacing correction coefficients.
}
\details{
\strong{Zero-Flow Period Selection:}

Zero-flow periods should represent times when sap flow is genuinely zero:
\itemize{
\item \strong{Ideal}: Extended periods of wet, cold, overcast weather
\item \strong{Winter}: Leafless deciduous trees in winter
\item \strong{Cut trees}: Freshly cut trees (first few hours)
\item \strong{Night}: Extended night periods (less reliable - low flow â‰  zero flow)
}

\strong{Quality Indicators:}
\itemize{
\item \strong{CV < 0.3}: Excellent stability, high confidence
\item \strong{CV 0.3-0.5}: Acceptable, moderate confidence
\item \strong{CV > 0.5}: High variability, consider longer/different periods
}

\strong{Recommendations:}
\itemize{
\item Use multiple periods (2-5) across different conditions
\item Each period should be at least 6-12 hours
\item Avoid periods immediately after rain (potential bark expansion)
\item Visually inspect Vh time series to confirm stability
}
}
\examples{
\dontrun{
# Define zero-flow periods
zero_periods <- list(
  list(start = "2024-05-01 00:00:00", end = "2024-05-05 23:59:59"),
  list(start = "2024-08-15 00:00:00", end = "2024-08-18 23:59:59")
)

# Calculate zero offset for outer sensor
zero_result <- calculate_zero_offset(
  vh_data = vh_cleaned,
  zero_periods = zero_periods,
  sensor_position = "outer",
  method = "HRM"
)

print(zero_result$zero_vh)  # e.g., 0.8 cm/hr
print(zero_result$overall_cv)  # e.g., 0.25 (good)
print(zero_result$period_summary)  # Check each period
}

}
\references{
Burgess, S.S.O., Adams, M.A., Turner, N.C., Beverly, C.R., Ong, C.K.,
Khan, A.A.H., & Bleby, T.M. (2001). An improved heat pulse method to
measure low and reverse rates of sap flow in woody plants.
\emph{Tree Physiology}, 21(9), 589-598.
}
\seealso{
Other spacing correction functions: 
\code{\link{apply_heartwood_reference_correction}()},
\code{\link{apply_manual_spacing_correction}()},
\code{\link{apply_spacing_correction}()},
\code{\link{apply_spacing_correction_both_sensors}()},
\code{\link{apply_spacing_correction_per_segment}()},
\code{\link{apply_spacing_correction_workflow}()},
\code{\link{calculate_burgess_coefficients}()},
\code{\link{check_heartwood_reference_available}()},
\code{\link{get_correction_coefficients}()},
\code{\link{print_spacing_correction_summary}()},
\code{\link{smooth_segment_junctions}()}
}
\concept{spacing correction functions}
