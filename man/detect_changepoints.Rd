% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03e_changepoint_detection.R
\name{detect_changepoints}
\alias{detect_changepoints}
\title{Detect Changepoints in Daily Minimum Velocities}
\usage{
detect_changepoints(
  daily_min,
  penalty = "MBIC",
  penalty_value = NULL,
  detection_type = "mean",
  min_segment_days = 7,
  merge_short_segments = TRUE
)
}
\arguments{
\item{daily_min}{Data frame with columns \code{date} and \code{min_value}
(typically from \code{\link{calculate_daily_minima}})}

\item{penalty}{Penalty type for PELT algorithm. Options:
\itemize{
\item "MBIC" - Modified Bayesian Information Criterion (default, most conservative)
\item "BIC" - Bayesian Information Criterion (moderate)
\item "Manual" - Manual penalty value (requires \code{penalty_value})
}}

\item{penalty_value}{Numeric penalty value when \code{penalty = "Manual"}.
Range typically 0-100. Higher values = fewer changepoints detected.}

\item{detection_type}{Type of change to detect:
\itemize{
\item "mean" - Changes in mean only (default, recommended)
\item "meanvar" - Changes in mean and/or variance
}}

\item{min_segment_days}{Minimum number of days for a segment (default: 7).
Segments shorter than this will be merged with adjacent segments.}

\item{merge_short_segments}{Logical, whether to merge segments shorter than
\code{min_segment_days} (default: TRUE)}
}
\value{
A list containing:
\item{changepoints}{Vector of changepoint dates (Date class)}
\item{changepoint_indices}{Vector of row indices in daily_min where changes occur}
\item{segments}{Data frame describing segments between changepoints}
\item{daily_min_with_segments}{Original daily_min with added \code{segment_id} column}
\item{parameters}{List of detection parameters used}
}
\description{
Uses PELT (Pruned Exact Linear Time) changepoint detection to identify
times when baseline sap flow velocities shift, indicating probe movement
or alignment changes requiring separate zero-offset calibration.
}
\details{
\strong{PELT Algorithm:}

PELT efficiently detects multiple changepoints by:
\itemize{
\item Searching for points where statistical properties change
\item Balancing model fit vs. number of changepoints (via penalty)
\item Guaranteeing optimal solution under model assumptions
}

\strong{Penalty Selection:}
\itemize{
\item \strong{MBIC}: Most conservative, fewer changepoints (recommended)
\item \strong{BIC}: Moderate, more changepoints than MBIC
\item \strong{Manual}: Full control, values 0-100 (0 = many changes, 100 = few changes)
}

\strong{Detection Types:}
\itemize{
\item \strong{mean}: Detects baseline shifts (probe movement, swelling/shrinkage)
\item \strong{meanvar}: Also detects changes in variability (environmental changes)
}

\strong{Short Segment Merging:}

Segments < min_segment_days are merged with adjacent segments because:
\itemize{
\item Too few observations for reliable zero-offset calculation
\item Often spurious detections from outliers
\item Practical: need sufficient data for Burgess correction
}
}
\examples{
\dontrun{
# Calculate daily minima
daily_min <- calculate_daily_minima(vh_results)

# Detect changepoints with default MBIC
result <- detect_changepoints(daily_min)

# View detected changepoints
print(result$changepoints)

# View segments
print(result$segments)

# Try BIC for more changepoints
result_bic <- detect_changepoints(daily_min, penalty = "BIC")

# Manual penalty for fine control
result_manual <- detect_changepoints(
  daily_min,
  penalty = "Manual",
  penalty_value = 50
)
}

}
\references{
Killick, R., Fearnhead, P., & Eckley, I. A. (2012). Optimal detection of
changepoints with a linear computational cost. \emph{Journal of the American
Statistical Association}, 107(500), 1590-1598.
}
\seealso{
Other changepoint detection functions: 
\code{\link{calculate_daily_minima}()},
\code{\link{extract_segment_baselines}()}
}
\concept{changepoint detection functions}
