% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03a_spacing_correction.R
\name{detect_zero_flow_periods}
\alias{detect_zero_flow_periods}
\title{Detect Candidate Zero-Flow Periods Automatically}
\usage{
detect_zero_flow_periods(
  vh_data,
  sensor_position,
  method_col = "method",
  method = "HRM",
  vh_col = "Vh_cm_hr",
  detection_method = "weekly",
  min_period_hours = 6,
  max_velocity_threshold = 2,
  max_cv_threshold = 0.3,
  max_candidates = 10
)
}
\arguments{
\item{vh_data}{Data frame containing velocity data with columns: datetime, sensor_position,
method, and velocity column (specified by vh_col)}

\item{sensor_position}{Sensor position to analyse ("outer" or "inner")}

\item{method_col}{Name of method column (default: "method")}

\item{method}{Value of method to analyse (default: "HRM")}

\item{vh_col}{Name of velocity column (default: "Vh_cm_hr")}

\item{detection_method}{Detection approach to use. Options:
\itemize{
\item "weekly" - Identify weekly minimum periods (default)
\item "monthly" - Identify monthly minimum periods
\item "statistical" - Use CV/velocity thresholds
\item "all" - Try all methods and return best candidates
}}

\item{min_period_hours}{Minimum duration for a candidate period in hours (default: 6)}

\item{max_velocity_threshold}{Maximum mean velocity for zero-flow candidates (cm/hr, default: 2.0)}

\item{max_cv_threshold}{Maximum coefficient of variation for stability (default: 0.3)}

\item{max_candidates}{Maximum number of candidates to return (default: 10)}
}
\value{
A data frame with candidate zero-flow periods containing:
\item{period_id}{Unique identifier for each candidate period}
\item{start}{Start datetime of period (POSIXct)}
\item{end}{End datetime of period (POSIXct)}
\item{duration_hours}{Duration of period in hours}
\item{mean_vh}{Mean velocity during period (cm/hr)}
\item{sd_vh}{Standard deviation of velocity}
\item{cv}{Coefficient of variation (SD/mean)}
\item{n_observations}{Number of observations in period}
\item{detection_method}{Method that identified this period}
\item{quality_score}{Quality score (0-100, higher is better)}
\item{recommendation}{"excellent", "good", "acceptable", or "questionable"}
}
\description{
Analyses velocity time series to automatically identify candidate zero-flow periods
using multiple detection methods: nighttime patterns, weekly/monthly minimums,
and statistical thresholds.
}
\details{
\strong{Detection Methods:}

\strong{Weekly Detection:}
\itemize{
\item Analyses weekly patterns to find minimum flow periods
\item Identifies weeks with consistently low velocities
\item Good for trees with weekly environmental variation
\item Best for datasets spanning multiple weeks
}

\strong{Monthly Detection:}
\itemize{
\item Identifies monthly minimum periods
\item Finds extended low-flow windows across months
\item Best for seasonal zero-flow (winter dormancy)
\item Requires at least 1 month of data
}

\strong{Statistical Detection:}
\itemize{
\item Uses velocity and CV thresholds to find stable low-flow periods
\item Looks for extended periods meeting both criteria
\item Method-agnostic, works for any flow pattern
\item Most flexible, works with any dataset length
}

\strong{Quality Scoring:}
Quality scores combine multiple factors:
\itemize{
\item Lower mean velocity (better)
\item Lower CV (more stable)
\item Longer duration (more reliable)
\item More observations (better statistics)
}

Scores > 80: Excellent candidates
Scores 60-80: Good candidates
Scores 40-60: Acceptable candidates
Scores < 40: Questionable candidates
}
\examples{
\dontrun{
# Detect weekly zero-flow periods
candidates <- detect_zero_flow_periods(
  vh_data = vh_results,
  sensor_position = "outer",
  method = "HRM",
  detection_method = "weekly"
)

# View top candidates
head(candidates)

# Filter to excellent candidates only
excellent <- candidates[candidates$recommendation == "excellent", ]

# Try all detection methods
all_candidates <- detect_zero_flow_periods(
  vh_data = vh_results,
  sensor_position = "outer",
  detection_method = "all",
  max_candidates = 15
)
}

}
\seealso{
Other spacing correction functions: 
\code{\link{apply_spacing_correction}()},
\code{\link{apply_spacing_correction_per_segment}()},
\code{\link{apply_spacing_correction_workflow}()},
\code{\link{calculate_burgess_coefficients}()},
\code{\link{calculate_zero_offset}()},
\code{\link{get_correction_coefficients}()},
\code{\link{print_spacing_correction_summary}()}
}
\concept{spacing correction functions}
