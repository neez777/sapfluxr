% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/04f_daily_aggregation.R
\name{aggregate_daily}
\alias{aggregate_daily}
\title{Aggregate sap flux to daily totals}
\usage{
aggregate_daily(
  data,
  datetime_col = "datetime",
  flux_density_col = "Qps_cm_hr",
  total_flux_col = "Q_cm3_hr",
  interval = "auto",
  require_complete_days = FALSE,
  min_measurements_per_day = NULL
)
}
\arguments{
\item{data}{Data frame containing sap flux measurements with datetime stamps.
Typically output from calc_sap_flux() or apply_sapwood_metrics().}

\item{datetime_col}{Character. Name of column containing POSIXct datetime
values. Default: "datetime".}

\item{flux_density_col}{Character. Name of column containing sap flux density
(Qps, cm/hr) for calculating daily mean flux density. If NULL, Jvm_daily
will not be calculated. Default: "Qps_cm_hr".}

\item{total_flux_col}{Character. Name of column containing total sap flux
(Qp, cm³/hr) for calculating daily total flux. If NULL, Qp_daily will not
be calculated. Default: "Q_cm3_hr".}

\item{interval}{Character. Measurement interval: "auto" (detect from data),
"hourly", "half-hourly", or a duration string like "30 min". Default: "auto".}

\item{require_complete_days}{Logical. If TRUE, only include days with complete
24-hour records (no missing timestamps). Default: FALSE.}

\item{min_measurements_per_day}{Integer. Minimum number of measurements
required per day. Days with fewer measurements will have NA values.
Default: NULL (no minimum).}
}
\value{
Data frame with one row per day containing:
\itemize{
\item date: Date (Date class)
\item datetime: Start of day (POSIXct, for plotting)
\item Jvm_daily_cm3_cm2_day: Daily total mean flux density (if flux_density_col provided)
\item Jvm_daily_mm_day: Same as above but in mm/day units (1 cm³/cm² = 10 mm)
\item Qp_daily_L_day: Daily total sap flux in L/day (if total_flux_col provided)
\item Qp_daily_cm3_day: Daily total sap flux in cm³/day (if total_flux_col provided)
\item n_measurements: Number of measurements in this day
\item hours_covered: Total hours spanned by measurements
\item data_completeness: Fraction of expected measurements present (0-1)
}
}
\description{
Calculates daily total sap flux metrics by integrating (summing) all
measurements over each 24-hour period. This produces daily mean sap flux
density (Jvm_daily) and/or daily total sap flux (Qp_daily).
}
\details{
For sub-daily measurements (e.g., hourly, half-hourly), the sum must be
adjusted by the measurement interval to get correct daily totals.

The daily integration formula depends on measurement interval:

For hourly measurements (n=24):
Jvm_daily = sum(Qps_i) [cm/day]
Qp_daily = sum(Q_i) / 1000 [L/day]

For half-hourly measurements (n=48):
Jvm_daily = sum(Qps_i) / 2 [cm/day]
Qp_daily = sum(Q_i) / 2 / 1000 [L/day]

General formula:
Jvm_daily = sum(Qps_i) × (interval_hours / 1)
Qp_daily = sum(Q_i) × (interval_hours / 1) / 1000

Units conversion:
\itemize{
\item Qps in cm/hr → Jvm_daily in cm³/cm²/day (= cm/day)
\item Q in cm³/hr → Qp_daily in L/day (divide by 1000)
\item Jvm in cm/day → mm/day (multiply by 10)
}
}
\examples{
\dontrun{
# After calculating sap flux metrics
hourly_data <- calc_sap_flux(flux_data, sapwood_areas)

# Aggregate to daily totals
daily_data <- aggregate_daily(hourly_data)

# Require complete days only
daily_data <- aggregate_daily(
  hourly_data,
  require_complete_days = TRUE
)

# Specify measurement interval
daily_data <- aggregate_daily(
  half_hourly_data,
  interval = "half-hourly"
)
}

}
\seealso{
Other daily aggregation: 
\code{\link{normalise_daily}()}
}
\concept{daily aggregation}
