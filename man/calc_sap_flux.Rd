% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/04d_sapwood_integration.R
\name{calc_sap_flux}
\alias{calc_sap_flux}
\title{Calculate Sap Flux by Integrating Over Sapwood Rings}
\usage{
calc_sap_flux(flux_data, sapwood_areas, method = "weighted_average")
}
\arguments{
\item{flux_data}{Data frame with sap flux density measurements. Must contain:
\describe{
\item{datetime}{Timestamp}
\item{sensor_position}{Sensor position ("outer", "inner")}
\item{Jv_cm3_cm2_hr}{Sap flux density (cm³/cm²/hr)}
}}

\item{sapwood_areas}{Output from \code{\link{calc_sapwood_areas}}}

\item{method}{Integration method. Options: "weighted_average" (default,
Hatton 1990) or "simple" (uniform weighting)}
}
\value{
Data frame with added columns:
\describe{
\item{Q_cm3_hr}{Total sap flux (cm³/hr) per timestamp}
\item{Q_L_hr}{Total sap flux (L/hr) per timestamp}
\item{Q_L_day}{Total sap flux (L/day) per timestamp}
}
}
\description{
Integrates sap flux density (Jv) measurements from multiple sensor depths
over the sapwood cross-sectional area to calculate total sap flux (Q).
Implements the weighted average method from Hatton et al. (1990).
}
\details{
\strong{Velocity Assumptions for Unmeasured Regions:}

Based on your spreadsheet specifications:
\enumerate{
\item \strong{Sapwood 10-20mm with inner sensor in heartwood:}
\itemize{
\item Inner ring velocity = Outer velocity / 2
\item (Linear decrease from outer boundary to heartwood)
}
\item \strong{Sapwood > 25mm with innermost region beyond sensors:}
\itemize{
\item Innermost ring velocity = Inner velocity / 2
\item (Linear decrease from inner boundary to heartwood)
}
}

\strong{Integration Formula (Hatton et al. 1990):}

Q = Σ (Aₖ × Jvₖ)

Where:
\itemize{
\item Aₖ = area of ring k (cm²)
\item Jvₖ = flux density for ring k (cm³/cm²/hr)
\item Sum over all sapwood rings
}
}
\examples{
\dontrun{
# Calculate sapwood areas
areas <- calc_sapwood_areas(dbh = 30, sapwood_depth = 3.5)

# Integrate flux density measurements
flux_data <- calc_sap_flux(flux_data, areas)

# View total flux
head(flux_data[, c("datetime", "Q_L_hr", "Q_L_day")])
}

}
\references{
Hatton, T.J., Catchpole, E.A., & Vertessy, R.A. (1990). Integration of
sapflow velocity to estimate plant water use. Tree Physiology, 6, 201-209.
}
\seealso{
Other sapwood integration functions: 
\code{\link{apply_sap_flux_integration}()},
\code{\link{calc_sapwood_areas}()}
}
\concept{sapwood integration functions}
