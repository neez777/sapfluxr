% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/04b_sdma_enhanced.R, R/04d_apply_calibration.R
\name{recalculate_peclet}
\alias{recalculate_peclet}
\title{Recalculate Peclet Number Using Corrected Velocities}
\usage{
recalculate_peclet(
  vh_results,
  probe_config,
  wood_properties,
  velocity_col = NULL,
  peclet_col = "peclet_number"
)

recalculate_peclet(
  vh_results,
  probe_config,
  wood_properties,
  velocity_col = NULL,
  peclet_col = "peclet_number"
)
}
\arguments{
\item{vh_results}{Data frame with velocity results (from calc_heat_pulse_velocity()
or after corrections)}

\item{probe_config}{Probe configuration object or path to YAML file}

\item{wood_properties}{Wood properties object or path to YAML file}

\item{velocity_col}{Column name containing velocity values to use for Peclet
calculation. Default: auto-detect in order of preference: Vc_cm_hr (corrected),
then Vh_cm_hr_sc (spacing corrected), then Vh_cm_hr (raw)}

\item{peclet_col}{Column name to store Peclet numbers. Default: "peclet_number"}

\item{vh_data}{Data frame or tibble containing heat pulse velocity results.
Must have HRM velocities and optionally corrected velocities (Vc_cm_hr or
Vh_cm_hr_wc column).}

\item{output_col}{Character. Name for output Peclet column.
Default: "Pe_corrected".}

\item{method}{Character. Which method to recalculate Peclet for.
Default: "HRM".}

\item{verbose}{Logical. Print calculation details (default: TRUE).}
}
\value{
The input data frame with an additional column containing recalculated
Peclet numbers. The column name is specified by \code{output_col}.

Data frame with updated Peclet number column
}
\description{
Recalculates the Peclet number (Pe) using corrected sap velocities after
spacing or wound corrections have been applied. This is CRITICAL for sDMA
because the Peclet number determines the theoretical validity limit of HRM,
and corrections can significantly change velocity values.

Recalculates Peclet numbers for velocity data after corrections have been
applied (spacing, wound, calibration, etc.). This is essential before applying
sDMA switching, as Peclet numbers must reflect the corrected velocities.
}
\details{
\strong{Why Recalculation is Critical:}

The Peclet number is defined as:
\deqn{Pe = \frac{V_c \cdot x}{D}}

Where:
\itemize{
\item \eqn{V_c} = sap velocity (cm/s)
\item \eqn{x} = probe spacing (cm)
\item \eqn{D} = thermal diffusivity (cm²/s)
}

When spacing or wound corrections are applied, \eqn{V_c} changes, invalidating
the original Peclet number. Using the original (raw) Peclet could:
\itemize{
\item Falsely indicate low flow (Pe < 1) when corrected flow is high
\item Incorrectly trigger sDMA switching
\item Violate HRM validity assumptions
}

\strong{Parameter Extraction:}

If \code{probe_config} or \code{wood_properties} are not provided, the function
will reverse-calculate them from an existing Peclet column using:
\deqn{\frac{x}{D} = \frac{Pe_{raw}}{V_{raw}}}

This assumes the original Peclet was correctly calculated.

\strong{Auto-Detection of Corrected Velocity:}

The function searches for corrected velocity columns in this order:
\enumerate{
\item \code{Vh_cm_hr_wc} - Wound-corrected (highest priority)
\item \code{Vh_cm_hr_sc} - Spacing-corrected
\item \code{Vc_cm_hr} - Generic corrected
\item \code{Vh_cm_hr} - Raw velocity (fallback)
}

\strong{Peclet Number Formula:}
\deqn{Pe = \frac{V_h \times x}{D \times 3600}}

where:
\itemize{
\item \eqn{V_h} = sap velocity (cm/hr)
\item \eqn{x} = probe spacing (cm)
\item \eqn{D} = thermal diffusivity (cm²/s)
\item 3600 = conversion factor (seconds to hours)
}

\strong{When to Use:}
\enumerate{
\item After spacing correction (Burgess et al. 2001)
\item After wound correction
\item Before applying sDMA (Selectable Dual Method Approach)
}

\strong{Why Recalculate?}
Spacing and wound corrections modify the velocity values, so Peclet numbers
calculated from raw velocities are no longer valid. sDMA switching relies on
accurate Peclet numbers to determine which method to use (Pe < 1.0: HRM,
Pe >= 1.0: secondary method).
}
\examples{
\dontrun{
# After wound correction, recalculate Peclet
vh_corrected <- apply_wound_correction(vh_results, ...)
vh_corrected <- recalculate_peclet(
  vh_data = vh_corrected,
  probe_config = probe_config,
  wood_properties = wood_properties
)

# Use recalculated Peclet for sDMA
vh_sdma <- apply_sdma_switching(
  data = vh_corrected,
  secondary = "MHR",
  mode = "peclet",
  peclet_col = "Pe_corrected"
)
}

\dontrun{
# Calculate initial velocities
vh <- calc_heat_pulse_velocity(hp_data, methods = c("HRM", "MHR"), wood)

# Apply spacing correction
vh_corrected <- apply_spacing_correction(vh, ...)

# Recalculate Peclet numbers based on corrected velocity
vh_corrected <- recalculate_peclet(
  vh_corrected,
  probe_config = probe,
  wood_properties = wood,
  velocity_col = "Vc_cm_hr"  # Use corrected velocity
)

# Now Peclet numbers reflect corrected velocities
# Ready for sDMA switching
}

}
\seealso{
Other sDMA functions: 
\code{\link{apply_sdma_switching}()},
\code{\link{auto_select_sdma_strategy}()},
\code{\link{calibrate_secondary_method}()}

Other calibration functions: 
\code{\link{apply_method_calibration}()}
}
\concept{calibration functions}
\concept{sDMA functions}
