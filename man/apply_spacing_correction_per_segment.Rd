% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03a_spacing_correction.R
\name{apply_spacing_correction_per_segment}
\alias{apply_spacing_correction_per_segment}
\title{Apply Spacing Correction Per Segment (Changepoint-Based)}
\usage{
apply_spacing_correction_per_segment(
  vh_data,
  changepoints,
  sensor_position,
  method = "HRM",
  method_col = "method",
  vh_col = "Vh_cm_hr",
  k_assumed = 0.0025,
  probe_spacing = 0.5,
  measurement_time = 80,
  lookup_table = NULL,
  baseline_overrides = NULL,
  create_new_col = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{vh_data}{Data frame containing velocity data}

\item{changepoints}{Vector of changepoint dates (Date class) dividing the time series}

\item{sensor_position}{Sensor position to correct ("outer" or "inner")}

\item{method}{Method to correct (default: "HRM")}

\item{method_col}{Name of method column (default: "method")}

\item{vh_col}{Name of velocity column (default: "Vh_cm_hr")}

\item{k_assumed}{Assumed thermal diffusivity (cmÂ²/s) (default: 0.0025)}

\item{probe_spacing}{Probe spacing (cm) (default: 0.5)}

\item{measurement_time}{Measurement time (sec) (default: 80)}

\item{lookup_table}{Optional pre-calculated Burgess lookup table}

\item{baseline_overrides}{Optional named list of manual baseline values per segment.
List names should be segment IDs ("1", "2", etc.). If a segment ID is not in
the list, baseline is auto-detected as minimum Vh in that segment.
Example: \code{list("1" = 0.8, "3" = 1.2)} overrides segments 1 and 3,
auto-detects segment 2. Default: NULL (all segments auto-detect).}

\item{create_new_col}{Logical, whether to create new corrected column (default: TRUE)}

\item{verbose}{Logical, whether to print progress messages (default: TRUE)}
}
\value{
A list containing:
\item{vh_corrected}{Data frame with spacing corrections applied}
\item{segment_results}{List of correction results per segment}
\item{metadata}{List containing correction metadata}
}
\description{
Applies spacing correction separately to each segment defined by changepoints,
calculating separate zero offsets and Burgess coefficients for each period.
This accounts for probe movement or alignment changes over time.
}
\details{
\strong{Changepoint-Based Correction:}

This function divides the time series into segments at changepoints and applies
independent spacing corrections to each segment. This is necessary when:
\itemize{
\item Tree swelling after rain causes probe misalignment
\item Tree shrinkage during drought moves probes
\item Physical disturbance shifts probe positions
\item Seasonal changes affect probe contact
}

\strong{Workflow Per Segment:}
\enumerate{
\item Identify data within segment boundaries
\item Calculate baseline (minimum) velocity for that segment
\item Look up Burgess correction coefficients
\item Apply segment-specific correction
}
}
\examples{
\dontrun{
# Detect changepoints
daily_min <- calculate_daily_minima(vh_results)
cpt_result <- detect_changepoints(daily_min)

# Apply segment-based correction
correction_result <- apply_spacing_correction_per_segment(
  vh_data = vh_results,
  changepoints = cpt_result$changepoints,
  sensor_position = "outer",
  method = "HRM"
)
}

}
\seealso{
Other spacing correction functions: 
\code{\link{apply_heartwood_reference_correction}()},
\code{\link{apply_manual_spacing_correction}()},
\code{\link{apply_spacing_correction}()},
\code{\link{apply_spacing_correction_both_sensors}()},
\code{\link{apply_spacing_correction_workflow}()},
\code{\link{calculate_burgess_coefficients}()},
\code{\link{calculate_zero_offset}()},
\code{\link{check_heartwood_reference_available}()},
\code{\link{get_correction_coefficients}()},
\code{\link{print_spacing_correction_summary}()},
\code{\link{smooth_segment_junctions}()}
}
\concept{spacing correction functions}
