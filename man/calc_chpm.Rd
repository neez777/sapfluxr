% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/05_heat_pulse_velocity_advanced.R
\name{calc_chpm}
\alias{calc_chpm}
\title{Compensation Heat Pulse Method (CHPM)}
\usage{
calc_chpm(
  temp_data,
  probe_spacing,
  pulse_time,
  max_time = 400,
  min_velocity = 6.75,
  validate = TRUE
)
}
\arguments{
\item{temp_data}{data.frame with columns: time, temp_up, temp_down, temp_far}

\item{probe_spacing}{list with upstream, downstream, and far probe distances (cm)}

\item{pulse_time}{numeric, duration of heat pulse (seconds)}

\item{max_time}{numeric, maximum time to search for crossover (seconds, default 400)}

\item{min_velocity}{numeric, minimum detectable velocity (cm/h, default 6.75)}

\item{validate}{logical, whether to perform data validation (default TRUE)}
}
\value{
list containing:
\item{velocity_chpm}{calculated CHPM velocity (cm/h)}
\item{crossover_time}{time when temp_up equals temp_far (seconds)}
\item{method_applicable}{logical, whether CHPM is applicable for this data}
\item{quality_metrics}{data quality indicators}
}
\description{
Calculate sap velocity using the Compensation Heat Pulse Method, which determines
velocity based on the time when temperature rises at two probes are equal.
This method is suitable for asymmetric probe configurations and moderate to high
sap velocities.
}
\details{
The CHPM calculates velocity as: V = (x1 + x3) / (2 * t_crossover)
where x1 and x3 are probe positions and t_crossover is when delta_1 = delta_3.

Method limitations:
\itemize{
\item Cannot detect negative (reverse) flows
\item Requires precise crossover point determination
\item Minimum detectable velocity depends on probe spacing and recording time
\item Less reliable at very low or very high velocities
}

Based on theory from:
\itemize{
\item Deng et al. (2021) "A double-ratio method to measure fast, slow and reverse sap flows"
\item Marshall (1958) heat pulse theory
}
}
\examples{
\dontrun{
# Typical probe configuration for CHPM
spacing <- list(upstream = -0.75, downstream = 0.75, far = 2.25)

# Calculate CHPM velocity
result <- calc_chpm(temp_data, spacing, pulse_time = 8)

# Check if method is applicable
if (result$method_applicable) {
  velocity <- result$velocity_chpm
}
}

}
\references{
Deng, Z., Vice, H., Gilbert, M., Adams, M., & Buckley, T. (2021).
A double-ratio method to measure fast, slow and reverse sap flows.
}
