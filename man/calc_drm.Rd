% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/05_heat_pulse_velocity_advanced.R
\name{calc_drm}
\alias{calc_drm}
\title{Double Ratio Method (DRM)}
\usage{
calc_drm(
  temp_data,
  probe_spacing,
  thermal_diffusivity = 0.0025,
  sensor_noise = 0.02,
  time_window = c(60, 100),
  validate = TRUE
)
}
\arguments{
\item{temp_data}{data.frame with columns: time, temp_up, temp_down, temp_far}

\item{probe_spacing}{list with upstream, downstream, and far probe distances (cm)}

\item{thermal_diffusivity}{numeric, thermal diffusivity (cm²/s, default 0.0025)}

\item{sensor_noise}{numeric, standard deviation of temperature sensor noise (K, default 0.02)}

\item{time_window}{numeric vector, time window for averaging (seconds, default c(60, 100))}

\item{validate}{logical, whether to perform data validation (default TRUE)}
}
\value{
list containing:
\item{velocity_drm}{final DRM velocity estimate (cm/h)}
\item{velocity_12}{velocity from probes 1-2 (cm/h)}
\item{velocity_23}{velocity from probes 2-3 (cm/h)}
\item{uncertainty_12}{uncertainty in V12 estimate}
\item{uncertainty_23}{uncertainty in V23 estimate}
\item{selected_method}{which estimate was selected ("V12" or "V23")}
\item{thermal_diffusivity_realtime}{real-time k estimate if available}
\item{quality_metrics}{comprehensive quality assessment}
}
\description{
Calculate sap velocity using the Double Ratio Method, which combines
two ratio-based velocity estimates and selects the one with lower uncertainty.
This method provides robust measurements across a wide range of velocities.
}
\details{
The DRM calculates two velocity estimates:
\itemize{
\item V12: Using temperature ratio between upstream and downstream probes
\item V23: Using temperature ratio between downstream and far probes
}

Selection criteria based on uncertainty:
\itemize{
\item Choose V12 if σ12 ≤ σ23 (typically at low velocities)
\item Choose V23 if σ23 < σ12 (typically at high velocities)
}

Advantages over single methods:
\itemize{
\item Works across unprecedented velocity range (-10 to 80+ cm/h)
\item Objective method selection based on uncertainty
\item Can provide real-time thermal diffusivity estimates
\item Robust against sensor noise at high velocities
}
}
\examples{
\dontrun{
# Standard DRM probe configuration
spacing <- list(upstream = -0.75, downstream = 0.75, far = 2.25)

# Calculate DRM velocity
result <- calc_drm(temp_data, spacing, thermal_diffusivity = 0.0025)

# Extract results
velocity <- result$velocity_drm
method_used <- result$selected_method
}

}
\references{
Deng, Z., Vice, H., Gilbert, M., Adams, M., & Buckley, T. (2021).
A double-ratio method to measure fast, slow and reverse sap flows.
}
