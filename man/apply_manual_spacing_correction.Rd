% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03c_spacing_correction_advanced.R
\name{apply_manual_spacing_correction}
\alias{apply_manual_spacing_correction}
\title{Apply Manual Spacing Correction with User-Specified Changepoints}
\usage{
apply_manual_spacing_correction(
  vh_data,
  manual_changepoints,
  baseline_overrides = NULL,
  sensor_position,
  method = "HRM",
  method_col = "method",
  vh_col = "Vh_cm_hr",
  k_assumed = 0.0025,
  probe_spacing = 0.5,
  measurement_time = 80,
  lookup_table = NULL,
  create_new_col = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{vh_data}{Data frame containing velocity data}

\item{manual_changepoints}{Vector of changepoint dates defining segment boundaries.
Can be character strings ("2024-03-15") or Date objects. These divide the
time series into n+1 segments.}

\item{baseline_overrides}{Optional named list specifying zero offset values for
specific date ranges. Names must be in format "start_date/end_date" and values
are the baseline Vh (cm/hr) to use for that segment.
Example: \code{list("2024-01-01/2024-03-15" = 0.8, "2024-03-16/2024-06-10" = 1.2)}
If a segment is not specified, its baseline will be auto-detected as the minimum.}

\item{sensor_position}{Sensor position to correct ("outer" or "inner")}

\item{method}{Method to correct (default: "HRM")}

\item{method_col}{Name of method column (default: "method")}

\item{vh_col}{Name of velocity column (default: "Vh_cm_hr")}

\item{k_assumed}{Assumed thermal diffusivity (cmÂ²/s) (default: 0.0025)}

\item{probe_spacing}{Probe spacing (cm) (default: 0.5)}

\item{measurement_time}{Measurement time (sec) (default: 80)}

\item{lookup_table}{Optional pre-calculated Burgess lookup table}

\item{create_new_col}{Logical, whether to create new corrected column (default: TRUE)}

\item{verbose}{Logical, whether to print progress messages (default: TRUE)}
}
\value{
A list containing:
\item{vh_corrected}{Data frame with spacing corrections applied, including:
\itemize{
\item \code{Vh_cm_hr_sc} - Spacing-corrected velocities (if create_new_col = TRUE)
\item \code{spacing_correction_applied} - Logical flag indicating correction
\item \code{spacing_correction_a} - Slope coefficient (a) applied per row
\item \code{spacing_correction_b} - Intercept coefficient (b) applied per row
\item \code{baseline_offset_cm_hr} - Zero-flow baseline used (cm/hr)
}
}
\item{segment_results}{List of correction results per segment}
\item{metadata}{List containing correction metadata}
}
\description{
Applies spacing correction using manually specified changepoints and optional
baseline overrides. This gives users full control over segment boundaries and
zero offsets when they have domain knowledge about probe conditions.
}
\details{
\strong{Manual Changepoint Specification:}

This function allows complete user control over:
\itemize{
\item Segment boundaries (via \code{manual_changepoints})
\item Zero offset values (via \code{baseline_overrides})
}

\strong{Workflow:}
\enumerate{
\item Parse manual changepoints to create segments
\item For each segment:
\itemize{
\item Check if baseline_overrides specifies a value for this date range
\item If yes, use the specified baseline
\item If no, auto-detect minimum Vh as baseline
}
\item Look up Burgess coefficients for each baseline
\item Apply segment-specific corrections
}

\strong{Date Range Format:}

The \code{baseline_overrides} parameter uses "start_date/end_date" format:
\itemize{
\item Dates should match the segment boundaries from changepoints
\item Format: "YYYY-MM-DD/YYYY-MM-DD"
\item Example: "2024-01-01/2024-03-15" = 0.8
}
}
\examples{
\dontrun{
# Example 1: Manual changepoints, auto-detect all baselines
correction <- apply_manual_spacing_correction(
  vh_data = vh_results,
  manual_changepoints = c("2024-03-15", "2024-06-10"),
  sensor_position = "outer",
  method = "HRM"
)

# Example 2: Manual changepoints with some baseline overrides
correction <- apply_manual_spacing_correction(
  vh_data = vh_results,
  manual_changepoints = c("2024-03-15", "2024-06-10"),
  baseline_overrides = list(
    "2024-01-01/2024-03-15" = 0.8,  # Segment 1: user-specified
    # Segment 2 will auto-detect (not specified)
    "2024-06-11/2024-12-31" = 1.5   # Segment 3: user-specified
  ),
  sensor_position = "outer"
)

# Example 3: Specify all baselines manually
correction <- apply_manual_spacing_correction(
  vh_data = vh_results,
  manual_changepoints = c("2024-03-15"),
  baseline_overrides = list(
    "2024-01-01/2024-03-15" = 0.8,
    "2024-03-16/2024-12-31" = 1.2
  ),
  sensor_position = "outer"
)
}

}
\references{
Burgess, S.S.O., Adams, M.A., Turner, N.C., Beverly, C.R., Ong, C.K.,
Khan, A.A.H., & Bleby, T.M. (2001). An improved heat pulse method to
measure low and reverse rates of sap flow in woody plants.
\emph{Tree Physiology}, 21(9), 589-598.
}
\seealso{
Other spacing correction functions: 
\code{\link{apply_heartwood_reference_correction}()},
\code{\link{apply_spacing_correction}()},
\code{\link{apply_spacing_correction_both_sensors}()},
\code{\link{calculate_burgess_coefficients}()},
\code{\link{calculate_zero_offset}()},
\code{\link{get_correction_coefficients}()},
\code{\link{print_spacing_correction_summary}()},
\code{\link{smooth_segment_junctions}()},
\code{\link{validate_zero_offset}()}
}
\concept{spacing correction functions}
