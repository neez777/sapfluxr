% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03a_zero_flow_offset.R
\name{apply_zero_flow_offset}
\alias{apply_zero_flow_offset}
\title{Apply Zero-Flow Linear Offset Correction}
\usage{
apply_zero_flow_offset(
  vh_data,
  zero_periods,
  sensors = c("outer", "inner"),
  methods = NULL,
  vh_col = "Vh_cm_hr",
  verbose = TRUE
)
}
\arguments{
\item{vh_data}{Data frame with vh_results structure (output from
\code{\link{calc_heat_pulse_velocity}})}

\item{zero_periods}{List of zero-flow periods. Each element should have:
\itemize{
\item \code{start}: Start datetime (POSIXct or character)
\item \code{end}: End datetime (POSIXct or character)
}}

\item{sensors}{Character vector of sensor positions to process.
Default: c("outer", "inner")}

\item{methods}{Character vector of methods to correct. If NULL (default),
applies to all methods present in the data.}

\item{vh_col}{Column containing current Vh values. Default: "Vh_cm_hr"}

\item{verbose}{Logical, print diagnostic messages. Default: TRUE}
}
\value{
Data frame with added columns:
\item{Vh_cm_hr_zf}{Zero-flow offset corrected values}
\item{Vh_cm_hr}{Updated to equal Vh_cm_hr_zf ("current" pointer)}
\item{zero_flow_offset_applied}{Logical, TRUE for corrected rows}

Attributes updated:
\item{current_vh_column}{"Vh_cm_hr_zf"}
\item{corrections_applied}{Appends "zero_flow_offset"}
\item{zero_flow_offset_results}{List of offset values per sensor/method}
}
\description{
Applies simple linear offset correction based on observed zero-flow periods.
This is an empirical correction suitable for all velocity calculation methods.
}
\details{
\strong{Correction Formula:}

\code{Vh_corrected = Vh_raw - offset}

Where \code{offset = mean(Vh)} during identified zero-flow periods

\strong{When to Use:}

Use zero-flow offset correction when:
\itemize{
\item You have identified genuine zero-flow periods
\item You want simple empirical correction
\item You're using non-HRM methods (MHR, Tmax)
\item Offset is large (>5 cm/hr) and Burgess correction fails validation
}

\strong{Applicability:}

Works for all methods: HRM, MHR, HRMXa, HRMXb, Tmax_Coh, Tmax_Klu

\strong{Alternative:}

For HRM/HRMX methods, consider \code{\link{apply_spacing_correction_workflow}}
which uses Burgess et al. (2001) physics-based correction. Burgess correction
is more accurate but only validated for offsets ≤ ±5 cm/hr.
}
\examples{
\dontrun{
# Calculate velocities
vh_results <- calc_heat_pulse_velocity(data, methods = c("HRM", "MHR"))

# Define zero-flow periods (e.g., nighttime with known zero flow)
zero_periods <- list(
  list(start = "2024-01-15 22:00:00", end = "2024-01-16 06:00:00"),
  list(start = "2024-01-16 22:00:00", end = "2024-01-17 06:00:00")
)

# Apply zero-flow offset correction to all methods
vh_corrected <- apply_zero_flow_offset(vh_results, zero_periods)

# Check results
attr(vh_corrected, "zero_flow_offset_results")

# Apply to specific methods only
vh_corrected <- apply_zero_flow_offset(
  vh_results,
  zero_periods,
  methods = c("MHR", "Tmax_Coh")
)
}
}
\seealso{
\code{\link{apply_spacing_correction_workflow}} for Burgess correction (HRM only)
}
\concept{zero-flow corrections}
