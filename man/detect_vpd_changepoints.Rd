% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/01j_vpd_changepoints.R
\name{detect_vpd_changepoints}
\alias{detect_vpd_changepoints}
\title{Detect VPD-Based Changepoints for Spacing Correction}
\usage{
detect_vpd_changepoints(
  daily_vpd,
  vpd_threshold = 0.5,
  min_segment_days = 7,
  require_consecutive = FALSE,
  min_consecutive_days = 3,
  max_changepoints = NULL
)
}
\arguments{
\item{daily_vpd}{Data frame with columns \code{date} and \code{min_vpd}
(typically from \code{\link{calculate_daily_vpd_minima}})}

\item{vpd_threshold}{Maximum VPD threshold (kPa). Days with minimum VPD at or
below this value are selected as changepoints. Default is 0.5 kPa (low atmospheric demand).
Typical values:
\itemize{
\item 0.3 kPa - Very conservative, very low VPD only
\item 0.5 kPa - Moderate, recommended default
\item 0.8 kPa - Permissive, allows higher VPD
}}

\item{min_segment_days}{Minimum number of days between selected changepoints
(default: 7). If changepoints are closer than this, only the day with lowest
VPD in that period is retained. This prevents over-sampling nearby dates.}

\item{require_consecutive}{Logical. If TRUE, requires at least
\code{min_consecutive_days} consecutive days below threshold to select the
middle day as a changepoint (default: FALSE). Use TRUE for stricter stability requirement.}

\item{min_consecutive_days}{If \code{require_consecutive = TRUE}, the minimum
number of consecutive days below threshold required (default: 3).}

\item{max_changepoints}{Maximum number of changepoints to return. If more days
meet criteria, those with lowest VPD are selected (default: NULL, no limit).}
}
\value{
A list containing:
\item{changepoints}{Vector of changepoint dates (Date class) when VPD conditions suitable}
\item{changepoint_indices}{Vector of row indices in daily_vpd corresponding to changepoints}
\item{vpd_values}{VPD values at each changepoint (kPa)}
\item{segments}{Data frame describing periods between changepoints}
\item{daily_vpd_with_segments}{Original daily_vpd with added \code{segment_id} column}
\item{parameters}{List of detection parameters used}
\item{n_days_below_threshold}{Total number of days meeting VPD threshold}
\item{n_changepoints_selected}{Number of changepoints after applying min_segment_days filter}
}
\description{
Identifies dates when daily minimum VPD is at or below a threshold, indicating
suitable environmental conditions for spacing correction. These dates serve as
"changepoints" analogous to PELT-detected baseline shifts, but based on
environmental stability rather than statistical change detection.
}
\details{
\strong{VPD Threshold Approach:}

Unlike PELT changepoint detection which identifies statistical changes in baseline,
this function identifies dates based on environmental suitability:
\itemize{
\item Selects days when VPD â‰¤ threshold (low atmospheric demand)
\item Ensures minimum spacing between selected dates
\item Optionally requires consecutive stable days
\item Returns dates as "changepoints" for spacing correction workflow
}

\strong{Threshold Selection:}

Choose threshold based on your site and objectives:
\itemize{
\item \strong{0.3 kPa}: Very stable, low demand conditions (few dates selected)
\item \strong{0.5 kPa}: Moderate stability, suitable for most applications (recommended)
\item \strong{0.8 kPa}: Permissive, allows moderate VPD (more dates available)
}

\strong{Minimum Segment Days:}

Spacing between changepoints (\code{min_segment_days}) ensures:
\itemize{
\item Independent calibration periods
\item Sufficient time between corrections
\item Avoids over-fitting to short-term VPD fluctuations
}

\strong{Consecutive Days Requirement:}

If \code{require_consecutive = TRUE}:
\itemize{
\item Ensures sustained low VPD, not just isolated days
\item More conservative selection
\item Selects middle day of consecutive period as changepoint
\item Better for sites with variable weather
}

\strong{Integration with Spacing Correction:}

The detected changepoint dates can be passed to spacing correction functions
to define periods for separate calibration:
\itemize{
\item Each segment between changepoints gets its own spacing correction
\item Corrections applied when environmental conditions are stable
\item Analogous to PELT-based segmentation but environmentally driven
}
}
\examples{
\dontrun{
# Calculate daily VPD minima
weather <- read_weather_data("weather_station.csv")
weather_vpd <- calc_vpd(weather)
daily_vpd <- calculate_daily_vpd_minima(weather_vpd)

# Detect changepoints with default threshold (0.5 kPa)
vpd_cpts <- detect_vpd_changepoints(daily_vpd)

# View selected dates
print(vpd_cpts$changepoints)
print(vpd_cpts$vpd_values)

# Stricter criteria: lower threshold, require consecutive days
vpd_cpts_strict <- detect_vpd_changepoints(
  daily_vpd,
  vpd_threshold = 0.3,
  require_consecutive = TRUE,
  min_consecutive_days = 3,
  min_segment_days = 14
)

# Permissive criteria: higher threshold
vpd_cpts_permissive <- detect_vpd_changepoints(
  daily_vpd,
  vpd_threshold = 0.8,
  min_segment_days = 7
)

# Limit number of changepoints, select lowest VPD days
vpd_cpts_limited <- detect_vpd_changepoints(
  daily_vpd,
  vpd_threshold = 0.5,
  max_changepoints = 10
)
}

}
\seealso{
\code{\link{calculate_daily_vpd_minima}} for preparing daily VPD data

Other VPD changepoint functions: 
\code{\link{calculate_daily_vpd_minima}()}
}
\concept{VPD changepoint functions}
